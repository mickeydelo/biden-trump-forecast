<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="/src/favicon/favicon.ico" />
    <link rel="apple-touch-icon" href="/src/favicon/apple-tourch-icon.png" />
    <link rel="stylesheet" href="/src/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <title>Trump vs Biden - Forecast</title>
  </head>
  <body>
    <div class="leader-bar"></div>
    <div class="leader-bar-biden"></div>

    <div class="container">
      <div id="election-display"></div>
      <div id="csv-display"></div>
    </div>
  </body>
</html>

<script type="text/javascript">
  $(document).ready(function () {
    var data;
    $.ajax({
      type: "GET",
      url:
        "https://projects.fivethirtyeight.com/2020-general-data/presidential_national_toplines_2020.csv",
      dataType: "text",

      success: function (response) {
        data = $.csv.toArrays(response);
        generateHtmlTable(data);
      },

      complete: function () {
        var trump =
          "#csv-display > table > tbody > tr:nth-child(1) > td:nth-child(8)";
        var biden =
          "#csv-display > table > tbody > tr:nth-child(1) > td:nth-child(9)";

        $(trump).each(function () {
          trumpText = $(this).html();
        });

        $(biden).each(function () {
          bidenText = $(this).html();
        });

        //trump
        var n = (trumpText * 1).toFixed(2);
        var p = n.replace("0", "");
        var z = p.replace(".", "");
        //biden
        var n2 = (bidenText * 1).toFixed(2);
        var p2 = n2.replace("0", "");
        var z2 = p2.replace(".", "");

        var trumpOutput =
          "<div class='trumpRender'>" +
          "<span class='trumpName'>Trump </span>" +
          "<span class='trumpScore count'>" +
          z +
          "</span>" +
          "</div>";
        var bidenOutput =
          "<div class='bidenRender'>" +
          "<span class='bidenName'>Biden </span>" +
          "<span class='bidenScore count'>" +
          z2 +
          "</span>" +
          "</div>";
        document.getElementById("election-display").innerHTML =
          trumpOutput + bidenOutput;

        var bidenBar = z2 + "%";
        //$(".leader-bar-biden").width(bidenBar);
        $(".leader-bar-biden").animate(
          {
            width: bidenBar
          },
          3000,
          "swing",
          function () {
            // Animation complete.
          }
        );

        $(".count").each(function () {
          $(this)
            .prop("Counter", 0)
            .animate(
              {
                Counter: $(this).text()
              },
              {
                duration: 1000,
                easing: "linear",
                step: function (now) {
                  $(this).text(Math.ceil(now));
                }
              }
            );
        });

        $("table").hide();
      }
    });

    function generateHtmlTable(data) {
      var html =
        '<table  class="table table-condensed table-hover table-striped">';

      if (typeof data[0] === "undefined") {
        return null;
      } else {
        $.each(data, function (index, row) {
          //bind header
          if (index == 0) {
            html += "<tr>";

            html += "</tr>";
            html += "<tbody>";
          } else {
            html += "<tr>";
            $.each(row, function (index, colData) {
              html += "<td>";
              html += colData;
              html += "</td>";
            });
            html += "</tr>";
          }
        });
        html += "</tbody>";
        html += "</table>";
        $("#csv-display").append(html);
      }
    }
  });
</script>
